<!-- Contenedor principal que espera los datos del estudiante -->
<div class="student-dashboard-container" *ngIf="studentData$ | async as data; else loading">

  <!-- 🛑 MEJORA: Pantalla de Bienvenida Motivacional -->
  <div *ngIf="showWelcomeScreen" class="welcome-screen">
    <div class="welcome-content">
      <h1 class="welcome-title">¡Hola, {{ data.profile.name }}!</h1>
      <p class="welcome-subtitle">
        Bienvenido a tu espacio en SIMPADE. Aquí, tu progreso y tu voz son lo más importante.
        Estamos para apoyarte en cada paso de tu camino educativo.
      </p>
      <button (click)="proceedToStatusView()" class="btn btn-primary btn-cta">
        ¡Estoy listo! Ver mi estado
      </button>
    </div>
  </div>

  <!-- Vista del Estado (se muestra después de hacer clic en el botón) -->
  <div *ngIf="!showWelcomeScreen">
    <div class="header">
      <h2>Mi Estado en SIMPADE</h2>
      <p>Aquí puedes consultar tu progreso y dejar tus comentarios para mejorar la convivencia.</p>
    </div>

    <!-- Tarjeta con la Información del Estudiante -->
    <div class="card status-card" *ngIf="data.details">
      <h3>Tu Información (Simulada)</h3>
      <div class="status-grid">
        <div class="status-item">
          <span class="label">Riesgo Actual:</span>
          <span class="value">{{ data.details.riskFactor }}</span>
        </div>
        <div class="status-item">
          <span class="label">Últimas Ausencias:</span>
          <span class="value">{{ data.details.absencesLastMonth }}</span>
        </div>
        <div class="status-item">
          <span class="label">Promedio General:</span>
          <span class="value">{{ data.details.academicAverage | number:'1.1-2' }}</span>
        </div>
      </div>
    </div>
    <div *ngIf="!data.details" class="alert error-alert">
      No se pudieron cargar los detalles de tu progreso. Por favor, contacta a tu docente.
    </div>

    <!-- Tarjeta con el Formulario de Feedback -->
    <div class="card feedback-card">
      <h3>¿Cómo te sientes? ¡Tu opinión importa!</h3>
      <form [formGroup]="feedbackForm" (ngSubmit)="submitFeedback()">
        <div class="form-group">
          <label for="feeling">¿Cómo te sientes en el colegio?</label>
          <select id="feeling" formControlName="feeling" class="form-control">
            <option>Excelente</option>
            <option>Bien</option>
            <option>Regular</option>
            <option>Necesito apoyo</option>
          </select>
        </div>
        <div class="form-group">
          <label for="category">Categoría</label>
          <select id="category" formControlName="category" class="form-control">
            <option>Convivencia</option>
            <option>Académico</option>
            <option>Instalaciones</option>
            <option>Otro</option>
          </select>
        </div>
        <div class="form-group">
          <label for="suggestion">¿Qué te gustaría mejorar?</label>
          <textarea id="suggestion" formControlName="suggestion" rows="4" class="form-control"></textarea>
        </div>
        <button type="submit" class="btn btn-accent">Enviar Mi Opinión</button>
      </form>
    </div>
  </div>
</div>

<!-- Template para el estado de carga -->
<ng-template #loading>
  <div class="loading-container">
    <p>Cargando tu información...</p>
  </div>
</ng-template>

